#+TITLE: gnuplot
#+DATE: <2024-12-27 vie>

|--------+-------------------------------------------------------|
| home   | http://gnuplot.info/                                  |
| faq    | http://gnuplot.info/faq/index.html                    |
| wiki   | https://en.wikipedia.org/wiki/Gnuplot                 |
| wiki   | https://en.wikibooks.org/wiki/Gnuplot                 |
| online | https://hostcat.fhsu.edu/cdclark/static/apps/gnuplot/ |
|--------+-------------------------------------------------------|

- 1986
- Thomas Williams, Colin Kelley, Russell Lang, Dave Kotz, John Campbell, Gershon Elber, Alexander Woo
- ~/.gnuplot, gnuplotrc (system-wide)
- .gp extension

* cli

#+begin_src
  gnuplot [x11 options] [options] [scriptfile ...]
#+end_src

|-----------+----+------------+---------------------------------|
|           | -e | CMDS       |                                 |
|           | -c | FILE [ARG] | runs script S with given args   |
| --persist | -p | -          | keep window after plotting ends |
| --slow    | -s | -          | wait for slow font init         |
| --default | -d | -          | do NOT read ~/.gnuplot          |
|-----------+----+------------+---------------------------------|

* language

#+begin_src gnuplot
  #!/usr/bin/gnuplot -persist
  a = 7             # variable assignent
  f(x,d) = d * x**2 # functions
  g(x)   = x <= 0 ? sin(x) : NaN
#+end_src

- NaN type
- "(/Symbol p)" - replaces parens with 𝛑
- curve fitting https://www.youtube.com/watch?v=vHM_5AeKwXE
- do for [i=1:96] { plot f(x,i*0.1) }
- operators http://www.gnuplot.info/docs_4.2/node55.html

** functions
- http://www.gnuplot.info/docs/loc1283.html
- math
- string
- time
- other
** input data

- space separated by default
- putting 2 newlines one after another, separate different blocks/groups of data

** commands

|-------+------------------------------------+-----------------------------|
|   <r> |                                    |                             |
| unset | OPTION                             |                             |
|   set | OPTION [VALUE]                     |                             |
|  with | (l)ines[*], dots[.], lines(points) |                             |
|  show | variables                          |                             |
| stats | FILENAME name S                    | shows file field statistics |
|       |                                    | later can be referenced     |
|       |                                    | eg: S_min_x                 |
|-------+------------------------------------+-----------------------------|

*** plot

|--------------+-------------------------|
|     <c>      |                         |
|    INPUT     | reads from...           |
|--------------+-------------------------|
|  "file.txt"  | file contents           |
| "/dev/stdin" | standard input          |
|   "< CMD"    | CMD stdout              |
|      ""      | re-use last given input |
|--------------+-------------------------|

- [re]plot INPUT [PLOT_A OPTS], INPUT [PLOT_B OPTS]
  - every N - plots every N data points
  - for [n = 1 : 5]
  - widths = "30 15 5"
    for [width in widths]
  - using N:N+1:N+n
  - [[http://www.gnuplot.info/docs/loc9016.html][smooth]]
    - [[http://www.gnuplot.info/docs/loc9099.html][frequency]] - points with the same X-value are replaced with 1 point with Y-values sum
    - [bezier¦mcsplines]
  - title S (for legend box)
  - bins=N - total N number of bins in graph http://gnuplot.info/docs_6.1/loc9125.html
  - binvalue=[avg¦sum] - how to group each bin, default: sum
  - index N
    - reference block N of data (aka separated by 2 \n)
    - blocks index start at 0
  - with
    - histograms
    - filledcurves
      - fillstyle pattern N
    - linespoint
    - lines
      - [d]ash[t]ype N
      - [d]ash[t]ype S
      - [l]ine[s]tyle N
      - [l]ine[t]ype N
      - [l]ine[c]olor rgb "#0b0000"
      - [l]ine[c]olor rgb "green"
      - [l]ine[w]ith N
    - points
      - pointsize N

*** other
- imagesc - matrix/heatmap - 2d contour
- splot - 3d surface
- hist
- scatter3 - 3d points
** options (setteable)

*** general

#+CAPTION: S ="string", N=number, F=float
|------------+------------+-------------------------------------|
|    <c>     |    <c>     |                                     |
|   table    | "FILENAME" | save plot to file, unset it after   |
|  encoding  |    utf8    |                                     |
|------------+------------+-------------------------------------|
|   title    |     S      | the                                 |
|   scale    |     N      |                                     |
|   output   |     S      | saves into filepath, unset it after |
| monochrome |     _      |                                     |
|------------+------------+-------------------------------------|
|   pause    |     N      | seconds to pause                    |
|  +reread+  |     -      | REMOVED in 6.0 +reread input+       |
|------------+------------+-------------------------------------|

*** general: file parsing

|-------------+-----------------+----------------------------------|
|     <c>     |       <c>       |                                  |
|-------------+-----------------+----------------------------------|
|  datafile   |   separator S   |                                  |
|             |  separator tab  |                                  |
|             | separator comma | input separator (default: space) |
|-------------+-----------------+----------------------------------|
| decimalsign |        S        | "." or ","                       |
|   samples   |        N        | sampling frequency               |
|  [xyz]data  |      time       | tells ? axis is a date/time      |
| timecolumn  |      N FMT      | INPUT format date on column N    |
|   timefmt   |       FMT       | INPUT format date                |
|   format    |    [x¦y] FMT    | OUTPUT format string, eg: %.2f   |
|-------------+-----------------+----------------------------------|

*** general: axis styling

#+CAPTION: S ="string", N=number, F=float
|---------------+----------------+----------------------------------|
|      <c>      |      <c>       |                                  |
|---------------+----------------+----------------------------------|
|    border     |      [N]       | pick axis lines (takes a bitsum) |
|     grid      |       -        | axis grid                        |
|   logscale    |   [x¦y] [N]    | with step N                      |
|   autoscale   |   [[x¦y]fix]   | prevents autoextend of scale     |
|     xdata     |      time      | tells ? axis is a date/time      |
|    format     |   [x¦y] FMT    | OUTPUT format string             |
| [xyz][2]range |     [N:N]      | axis range                       |
| [xyz][2]tics  |    nomirror    | axis numbers                     |
|               |     rotate     |                                  |
|               | START,STEP,END |                                  |
|               |  (S N[,S N])   | custom labels S at point N       |
|   [xyz]tic    |  rotate by N   | rotates tic labels               |
| [xyz][2]label |       S        | axis label                       |
|               |    offset N    |                                  |
|---------------+----------------+----------------------------------|
*** key

|-----+---------------+-------------------------------|
|     |      <c>      |                               |
| key |    [BLTR]     | position legend box           |
|     |    [no]box    | enable/disable                |
|     | at graph F, F |                               |
|     |    width N    |                               |
|     |    font S     | use ",14" to change size only |
|     |    at N,N     |                               |
|-----+---------------+-------------------------------|

*** style

|-----------+---------------+----------------------------------|
|    <c>    |      <c>      |                                  |
|   fill    |  transparent  |                                  |
|           |     solid     |                                  |
|   solid   |       F       |                                  |
| noborder  |       _       |                                  |
|   data    |     lines     | sets default for *plot* with ... |
|           |  histograms   |                                  |
|   line    |       N       | can be later referenced on plot  |
| histogram |     gap N     |                                  |
|           |    cluster    |                                  |
|           |   clustered   |                                  |
|           |  rowstacked   |                                  |
|           | columnstacked |                                  |
|-----------+---------------+----------------------------------|

#+CAPTION: gnuplot "test" command output
#+ATTR_HTML: :width 500
#+ATTR_ORG: :width 600
[[./test_page.png]]

*** term[inal]

- gif [animate¦delay]
- png [size¦font]
- pngcairo
- wxt
- xterm (xterm tektronix mode)
- dumb (aka ascii)

*** palette

http://gnuplot.info/demo/pm3dcolors.html

#+begin_src gnuplot
  set palette rgb 7,5,15
  set palette defined (0 0 0 0, 0.3 1 0 0, 0.6 "blue", 1 "#ffffff")
#+end_src

* snippets

- simple pipe
  #+begin_src sh
    $ gnuplot -p -e "plot '<cat'" < rawnumbers # opens qt window
    $ gnuplot -p -e "plot '-'"    < rawnumbers # opens qt window
    $ GNUTERM=dumb gnuplot -e "plot '-'"    < rawnumbers # ascii plot
  #+end_src

- stream - draw last 200 lines, ten times per second
  #+begin_src sh
   while (1) {
     plot "< tail -200 plot.dat" using 1:2 with lines
     pause 0.1
   }
  #+end_src

* examples

- https://github.com/TheFox/gnuplot-examples
- https://gnuplot.info/screenshots/index.html
- https://gnuplot.sourceforge.net/demo_5.4/

* tools

- emacs: [[https://orgmode.org/worg/org-contrib/babel/languages/ob-doc-gnuplot.html][Org-babel-gnuplot]]
- wrapper: plot realtime and stored data from the cli https://github.com/dkogan/feedgnuplot
- config https://github.com/Gnuplotting/gnuplot-configs
- pallettes
  - https://github.com/Gnuplotting/gnuplot-palettes
  - https://github.com/aschn/gnuplot-colorbrewer

* gotchas

- by default wants *space* separated fields
- sizes are given in pixels, can be undesired when exporting at large dimensions
- plot field indexing starts at $1
- poor compiler messages
- different compiler messages when reading a script or from *-e*
- no *%a* date format for input parsing
- to read from stdin "-" might not work in plot (?
  - use /dev/stdin
